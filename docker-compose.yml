# NOTES:
# general
# - the build context is in the docker-compose directory so that
#   all containers can use the same grpcio_init script
# edex_server
# - privileged mode is required on macOS for networking
# - the edex server talks on ports 9581, 9582 to CAVE/python-awips
# - the edex server talks on ports 388 to the upstream LDM
#
# edex_process
version: "3"
services:
  edex_server:
    build: 
      context: .
      dockerfile: ./edex_server/Dockerfile
    privileged: true
    container_name: edex_server
    ports:
      # these ports used for CAVE/python-awips communication
      - 9581:9581
      - 9582:9582
      # this port used to talk to LDM
      - 388:388


  # Container to bridge the EDEX server and TF server
  #   handles data preprocessing
  edex_process:
    build: 
      context: .
      dockerfile: ./edex_process/Dockerfile
    # required for macOS
    privileged: true
    container_name: edex_process

# sample for TF
        #  edex_tf:
        #    build: edex_tf/.
        #    privileged: true
        #    container_name: edex_tf
        #    ports:
        #      # gRPC port
        #      - 8500:8500
        #      # REST API port
        #      - 8501:8501
        #      # communication with EDEX
        #      - 9696:9696
        #    volumes:
        #      - type: bind
        #        source: ./edex_tf/serving/tensorflow_serving/servables/tensorflow/testdata/saved_model_half_plus_two_cpu
        #        target: /models/half_plus_two



